function Game(idx){let gameState=0,sprite=new Sprite,player=new Flappy;var tunnels=[new Tunnel(0),new Tunnel(1),new Tunnel(2),new Tunnel(3)];let flappyDiv=document.getElementById("flappy"+idx),startInterval,gameInterval,endInterval;flappyDiv.style.top="10px",flappyDiv.style.left=10+400*idx+"px";let wingCounter=0,canvas=document.createElement("canvas");canvas.setAttribute("class","canvas"),flappyDiv.appendChild(canvas);let ctx=canvas.getContext("2d");function drawBackground(){for(var i=0;i<4;i++)ctx.drawImage(sprite.img,sprite.bg[0],sprite.bg[1],sprite.bg[2],sprite.bg[3],144*i,0,144,CANVAS_HEIGHT)}function drawPlayer(){0==player.wingPosition?player.wingDirection=1:2==player.wingPosition&&(player.wingDirection=-1);let wing=sprite.flappy[player.wingPosition];ctx.drawImage(sprite.img,wing[0],wing[1],wing[2],wing[3],PLAYER_X,player.y,52,36),13==wingCounter&&(player.wingPosition+=player.wingDirection,wingCounter=0)}function drawStartScreen(){startInterval=setInterval((function(){ctx.beginPath(),drawBackground(),ctx.drawImage(sprite.img,sprite.start[0],sprite.start[1],sprite.start[2],sprite.start[3],262,225,52,29),ctx.drawImage(sprite.img,sprite.logo[0],sprite.logo[1],sprite.logo[2],sprite.logo[3],197,125,182,48)}),17)}function drawTunnels(){for(var i=0;i<tunnels.length;i++)ctx.drawImage(sprite.img,sprite.tunnelUp[0],sprite.tunnelUp[1],sprite.tunnelUp[2],sprite.tunnelUp[3],tunnels[i].x,tunnels[i].height-3*sprite.tunnelUp[3],TUNNEL_WIDTH,3*sprite.tunnelUp[3]),ctx.drawImage(sprite.img,sprite.tunnelDown[0],sprite.tunnelDown[1],sprite.tunnelDown[2],sprite.tunnelDown[3],tunnels[i].x,tunnels[i].height+TUNNEL_GAP,TUNNEL_WIDTH,3*sprite.tunnelDown[3]),tunnels[i].move()}function displayScore(score){for(var scoreString=score.toString(),numDist=280,i=scoreString.length-1;i>=0;i--){let num=parseInt(scoreString[i]);ctx.drawImage(sprite.img,sprite.numBig[num][0],sprite.numBig[num][1],sprite.numBig[num][2],sprite.numBig[num][3],numDist,10,sprite.numBig[num][2],sprite.numBig[num][3]),numDist-=13}}function startGame(){gameInterval=setInterval((function(){wingCounter+=1,ctx.beginPath(),drawBackground(),drawPlayer(),drawTunnels(),player.addScore(tunnels),displayScore(player.getScore()),player.move(),player.checkWallCollision()&&endGame()}),17)}function endGame(){gameState=2,player.reset(),clearInterval(gameInterval),ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctx.beginPath(),drawBackground(),ctx.drawImage(sprite.img,sprite.start[0],sprite.start[1],sprite.start[2],sprite.start[3],262,225,52,29),ctx.drawImage(sprite.img,sprite.gameOver[0],sprite.gameOver[1],sprite.gameOver[2],sprite.gameOver[3],197,125,182,48)}canvas.width=CANVAS_WIDTH,canvas.height=CANVAS_HEIGHT,flappyDiv.onmousedown=function(e){var cursorX=e.pageX-parseFloat(flappyDiv.style.left),cursorY=e.pageY-parseFloat(flappyDiv.style.top);0!=gameState&&2!=gameState||262<=cursorX&&cursorX<=314&&225<=cursorY&&cursorY<=254&&(clearInterval(startInterval),ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),gameState=1,startGame())},flappyDiv.addEventListener("keydown",(function(e){" "==e.key&&(player.goUp||player.workedOnce||(player.goUp=!0))})),flappyDiv.addEventListener("keyup",(function(e){" "==e.key&&(player.workedOnce=!1)})),drawStartScreen()}